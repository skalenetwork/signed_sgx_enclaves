name: Sign and release SGX enclave
on:
  workflow_dispatch:
  push:
jobs:
  build:
    runs-on: ubuntu-18.04
    env:
      ACTIONS_ALLOW_UNSECURE_COMMANDS: true
      KEY: ${{ secrets.V2 }}
    steps:
      - name: Fail, if older Github Actions machine. Click "Re-run jobs"
        run: cat /proc/cpuinfo | grep avx512
      - name: Run docker container
        run: docker run --name release skalenetwork/sgxwallet_intelsubmission:stable-latest
      - name: sleep 1 sec
        run: sleep 1
      - name: sign
        run: docker run --name release -v $PWD/signed_enclaves:/usr/src/sdk/signed_enclaves --entrypoint /bin/bash skalenetwork/sgxwallet_intelsubmission:stable-latest
      
        
        
